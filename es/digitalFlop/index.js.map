{"version":3,"file":"index.js","sources":["../../src/components/digitalFlop/index.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react'\r\n\r\nimport PropTypes from 'prop-types'\r\n\r\nimport CRender from '@jiaminghi/c-render'\r\n\r\nimport '@jiaminghi/charts/lib/extend/index'\r\n\r\nimport { deepMerge } from '@jiaminghi/charts/lib/util/index'\r\n\r\nimport { deepClone } from '@jiaminghi/c-render/lib/plugin/util'\r\n\r\nimport './style.less'\r\n\r\nconst defaultConfig = {\r\n  /**\r\n   * @description Number for digital flop\r\n   * @type {Array<Number>}\r\n   * @default number = []\r\n   * @example number = [10]\r\n   */\r\n  number: [],\r\n  /**\r\n   * @description Content formatter\r\n   * @type {String}\r\n   * @default content = ''\r\n   * @example content = '{nt}个'\r\n   */\r\n  content: '',\r\n  /**\r\n   * @description Number toFixed\r\n   * @type {Number}\r\n   * @default toFixed = 0\r\n   */\r\n  toFixed: 0,\r\n  /**\r\n   * @description Text align\r\n   * @type {String}\r\n   * @default textAlign = 'center'\r\n   * @example textAlign = 'center' | 'left' | 'right'\r\n   */\r\n  textAlign: 'center',\r\n  /**\r\n   * @description Text style configuration\r\n   * @type {Object} {CRender Class Style}\r\n   */\r\n  style: {\r\n    fontSize: 30,\r\n    fill: '#3de7c9'\r\n  },\r\n  /**\r\n   * @description CRender animationCurve\r\n   * @type {String}\r\n   * @default animationCurve = 'easeOutCubic'\r\n   */\r\n  animationCurve: 'easeOutCubic',\r\n  /**\r\n   * @description CRender animationFrame\r\n   * @type {String}\r\n   * @default animationFrame = 50\r\n   */\r\n  animationFrame: 50\r\n}\r\n\r\nconst DigitalFlop = ({ config = {} }) => {\r\n  const domRef = useRef(null)\r\n  const rendererRef = useRef(null)\r\n  const graphRef = useRef(null)\r\n\r\n  const mergedConfigRef = useRef(null)\r\n\r\n  const mountedRef = useRef(true)\r\n\r\n  function init() {\r\n    rendererRef.current = new CRender(domRef.current)\r\n\r\n    mergedConfigRef.current = getMergedConfig()\r\n\r\n    graphRef.current = getGraph()\r\n  }\r\n\r\n  const getMergedConfig = () =>\r\n    deepMerge(deepClone(defaultConfig, true), config || {})\r\n\r\n  function getGraph() {\r\n    const { animationCurve, animationFrame } = mergedConfigRef.current\r\n\r\n    return rendererRef.current.add({\r\n      name: 'numberText',\r\n      animationCurve,\r\n      animationFrame,\r\n      shape: getShape(),\r\n      style: getStyle()\r\n    })\r\n  }\r\n\r\n  function getShape() {\r\n    const { number, content, toFixed, textAlign } = mergedConfigRef.current\r\n    const [w, h] = rendererRef.current.area\r\n\r\n    const position = [w / 2, h / 2]\r\n\r\n    if (textAlign === 'left') position[0] = 0\r\n    if (textAlign === 'right') position[0] = w\r\n\r\n    return { number, content, toFixed, position }\r\n  }\r\n\r\n  function getStyle() {\r\n    const { style, textAlign } = mergedConfigRef.current\r\n\r\n    return deepMerge(style, {\r\n      textAlign,\r\n      textBaseline: 'middle'\r\n    })\r\n  }\r\n\r\n  useEffect(init, [])\r\n\r\n  function update() {\r\n    const mergedConfig = (mergedConfigRef.current = getMergedConfig())\r\n    const graph = graphRef.current\r\n\r\n    const shape = getShape()\r\n\r\n    const cacheNum = graph.shape.number.length\r\n    const shapeNum = shape.number.length\r\n\r\n    cacheNum !== shapeNum && (graph.shape.number = shape.number)\r\n\r\n    const { animationCurve, animationFrame } = mergedConfig\r\n\r\n    Object.assign(graph, { animationCurve, animationFrame })\r\n\r\n    graph.animation('style', getStyle(), true)\r\n    graph.animation('shape', shape)\r\n  }\r\n\r\n  useEffect(() => {\r\n    !mountedRef.current && update()\r\n\r\n    return () => {\r\n      mountedRef.current = false\r\n    }\r\n  }, [config])\r\n\r\n  return (\r\n    <div className='dv-digital-flop'>\r\n      <canvas ref={domRef} />\r\n    </div>\r\n  )\r\n}\r\n\r\nDigitalFlop.propTypes = {\r\n  config: PropTypes.object\r\n}\r\n\r\n// 指定 props 的默认值：\r\nDigitalFlop.defaultProps = {\r\n  config: {}\r\n}\r\n\r\nexport default DigitalFlop\r\n"],"names":["defaultConfig","DigitalFlop","config","domRef","useRef","rendererRef","graphRef","mergedConfigRef","mountedRef","init","current","CRender","getMergedConfig","getGraph","deepMerge","deepClone","animationCurve","animationFrame","add","getShape","getStyle","number","content","toFixed","textAlign","area","w","h","position","style","update","mergedConfig","graph","shape","cacheNum","length","shapeNum","assign","animation","propTypes","PropTypes","object","defaultProps"],"mappings":"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"}